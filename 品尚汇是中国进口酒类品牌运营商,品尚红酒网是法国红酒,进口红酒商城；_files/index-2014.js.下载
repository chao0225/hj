var common = {
	display:function(id)
	{
		$(id).animate({
			opacity: 0.25,
			height: 'toggle'
		}, 500, function() {
		});
		return;
	},
	gotoPayNows:function()
	{
		//if(window.GridsumWebDissector){
		//	var _gsTracker =GridsumWebDissector.getTracker('GWD-002211');
		//	_gsTracker.track('/targetpage/pay_now.html');
		//}
		common.location('/order.php?a=cartlist');
	},
	//获取GET参数
	GetQueryString:function(name)
	{
		var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r!=null) return unescape(r[2]); return null;
	},
	
	//跳转链接
	location:function(url)
	{
		window.location.href=url;	
	},
	//getHeight
	getContentHeight:function(){
		var bodyCath=document.body;
		var doeCath=document.compatMode=='BackCompat'?bodyCath:document.documentElement;
		return(window.MessageEvent&&navigator.userAgent.toLowerCase().indexOf('firefox')==-1)?bodyCath.scrollHeight:doeCath.scrollHeight;
	},
	//getWidth
	getContentWidth:function(){
		var bodyCath=document.body;
		var doeCath=document.compatMode=='BackCompat'?bodyCath:document.documentElement;
		return(window.MessageEvent&&navigator.userAgent.toLowerCase().indexOf('firefox')==-1)?bodyCath.scrollWidth:doeCath.scrollWidth;
	},
	getTop:function(e){   
         var offset=e.offsetTop;   
         if(e.offsetParent!=null) offset+=this.getTop(e.offsetParent);   
         return offset;   
    },
	getLeft:function(e){   
         var offset=e.offsetLeft;   
         if(e.offsetParent!=null) offset+=this.getLeft(e.offsetParent);   
         return offset;   
    },
	//load img
	LazyImg:function(obj)
	{
		obj.find('img[data-original]').each(function(){$(this).attr('src', $(this).attr('data-original')).removeAttr('data-original');});
	},
	id:function(t)
	{
		return document.getElementById(t)
	},
	//删除class
	delClass:function(ids,cName){
		common.setClass(ids,cName,"remove");
	},
	hasClass:function(old,cur){
		if(!old||!cur)return null;
		var arr=old.split(' ');
		for(var i=0,len=arr.length;i<len;i++)
		{
			if(cur==arr[i]){return cur;}
		};
		return null;
	},
	//setClass
	setClass:function(ids,cName,kind){
		if(typeof(ids)=="string")
		{
			var arrDom=ids.split(",");
			for(var i=0,len=arrDom.length;i<len;i++)
			{
				setClass($id(arrDom[i]),cName,kind);
				}
			};
			if(ids instanceof Array)
			{
				for(var i=0,len=ids.length;i<len&&ids[i];i++)
				{
					setClass(ids[i],cName,kind);
				}
			}
			else
			{
				setClass(ids,cName,kind);
			};
			function setClass(obj,cName,kind){
				if(!obj){return;
			};
			var oldName=obj.className,arrName=oldName?oldName.split(' '):[];
			if(kind=="add"){
				if(!common.hasClass(oldName,cName)){
					arrName.push(cName);
					obj.className=arrName.join(' ');
				}
			}else if(kind=="remove"){
				var newName=[];
				for(var i=0,len=arrName.length;i<len;i++)
				{
					if(cName!=arrName[i]&&' '!=arrName[i])
					{
						newName.push(arrName[i]);
					}
				};
				obj.className=newName.join(' ');
			}
		}
	},
	searchIt:function(o)
	{
		var str = o.action.replace(/#####/, escape(o.keywords.value));
		common.location(str);
		return false;
	},
	clearvalue:function(o)
	{
		if(typeof o.oldValue == 'undefined')
		{
			o.oldValue = o.value;
			o.style.color = "#555555";
		}
		if(o.value == o.oldValue)
		{
			o.value = '';	
		}
		o.onblur=function()
		{
			if(this.value == '')
			{
				//o.value = o.oldValue;
			}
		}
		
	},
	//检查radio是否被选中了
	isChecked:function(o){
		var objVal = $(o).filter(":checked").val();
		if(objVal != 'undefined' && Utils.isNumber(objVal))
		{
			return true;
		}
		for(var i=0;i < o.length; i++){
			obj = o[i];
			if(obj.checked == true){
				return true;
				break;
			}
		}
		return false;
	}
};

//浮动层
var floatDiv = {
	//显示内容
	showBox:function(content,L,T)
	{
		var c=document.createElement("div");
		document.body.appendChild(c);
		c.style.position="absolute";
		c.style.left = L+'px';
		c.style.top  = T+'px';
		c.style.zIndex  = '999';	
		c.style.backgroundColor  = '#FFFFFF';
		c.innerHTML  = content;
		return c;
	},
	//显示div
	show:function(d,o,H,W)
	{
		
		var T = common.getTop(o);
		var L = common.getLeft(o);
		var obj = floatDiv.showBox(d,L+W,T+H);
		obj.onmouseover=function()
		{
			floatDiv.over(o,this,H,W);
		};
		obj.onmouseout=function()
		{
			floatDiv.out(this);
		};
		return obj;
	},
	fixshow:function(o, source, H, W, type)
	{
		if(type == 0)
		{
			$.get(source, function(d){ 
				var T = common.getTop(o);
				var L = common.getLeft(o);
				var obj = floatDiv.showBox(d,L+W,T+H);
			});
		}
		else
		{
			var T = common.getTop(o);
			var L = common.getLeft(o);
			var obj = floatDiv.showBox(source,L+W,T+H);
		}
		return obj;
	},
	//移动
	over:function(oNav,o,H,W)
	{
		if(typeof o.settime != 'undefined')
		{
			clearInterval(o.settime);
		}
		if(o.style.display == 'none')
		{
			o.style.display = '';
			var T = H+common.getTop(oNav);
			var L = W+common.getLeft(oNav);
			o.style.left = L+'px';
			o.style.top  = T+'px';
		}
	},
	//移出去
	out:function(o)
	{
		if(o.style.display == '')
		{
			o.settime = setTimeout(function(){floatDiv.display(o,'none')},200);
		}
	},
	//display is none
	display:function(o, type)
	{
		o.style.display = type;
	},
	//AJAX TryShow
	tryShow:function(o, source, H, W, type) //点击的对象，浮动的来源，高度的浮动，类型（0是ajax,1是div）
	{
		if(typeof o.firstFlag == 'undefined')
		{
			o.firstFlag = true;
			var d = source;
			if(type == 0)
			{
				if(o.isNeedLoad == true)
				{
					o.obj = floatDiv.show(o.loadDiv,o,H,W);
					$.get(source, function(d){ 
						o.obj.innerHTML = d;
					});
				}
				else
				{
					$.get(source, function(d){ 
						o.obj = floatDiv.show(d,o,H,W);
					});
				}
			}
			else
			{
				o.obj = floatDiv.show(d,o,H,W);	
			}
		}
		else if(o.firstFlag == true && typeof o.obj != 'undefined')
		{
			floatDiv.over(o,o.obj,H,W);
		}
	},
	//点击固定的先加载再显示
	tryFixShow:function(o, source, H, W, type) //点击的对象，浮动的来源，高度的浮动，类型（0是ajax,1是div）
	{
		if(typeof o.firstFlag == 'undefined')
		{
			o.firstFlag = true;
			var d = source;
			if(type == 0)
			{
				if(o.isNeedLoad == true)
				{
					o.obj = floatDiv.fixshow(o,o.loadDiv,H,W,1);
					$.get(source, function(d){ 
						o.obj.innerHTML = d;
					});
				}
				else
				{
					$.get(source, function(d){ 
						o.obj = floatDiv.fixshow(o,d,H,W,type);
					});
				}
			}
			else
			{
				o.obj = floatDiv.fixshow(o,d,H,W,type);	
			}
		}
		else if(o.firstFlag == true && typeof o.obj != 'undefined')
		{
			floatDiv.fixshow(o,o.obj.innerHTML,H,W,1);
		}
	},
	move:function(o, source, H, W, type)
	{
		if(typeof o.Startflag != 'number')
		{
			o.Startflag  = setTimeout(function(){floatDiv.tryShow(o, source, H, W, type)},300);
			o.onmouseout = function()
			{
				clearTimeout(o.Startflag);	
				o.Startflag = false;
				if(typeof o.obj != 'undefined')
				{
					floatDiv.out(o.obj);
				}
			}
		}	
	},
};



//其他函数
var functions = {

		AddFavorite : function(sURL, sTitle) 
		{
			sURL = encodeURI(sURL); 
			try{   
				window.external.addFavorite(sURL, sTitle);   
			}catch(e) {   
				try{   
					window.sidebar.addPanel(sTitle, sURL, "");   
				}catch (e) {   
					alert("加入收藏失败，请使用Ctrl+D进行添加,或手动在浏览器里进行设置.");
				};
			};
		},

		left_muen : function()
		{
			var p=".pop-subcategory",
			i=".nav_list li",
			s="trak",
			o="o",
			t="t";
		
			$(i).mouseover(function(){
				$(i).removeClass(s); 
				$(this).addClass(s); 
				$(p).hide(); 
				var activeTab = $(this).attr("id").replace("N_","");
				 
				$("#"+activeTab).show();
				return false; 
			});	
			
			$(i).mouseout(function() { 
				$(this).removeClass(s); 
				$(p).hide(); 
				return false; 
			}); 
			
			$(p).mouseover(function() {
				$(this).show();
				$(i).removeClass(s);
				var activeNav = $(this).attr("id");
				$("#N_"+activeNav).addClass(s);
				return false; 
			});
			
			$(p).mouseout(function() {
				$(this).hide();
				var activeNav = $(this).attr("id");
				$("#N_"+activeNav).removeClass(s);
				return false; 
			});
		},

		ShowCountDown : function(ld, lh, lm, ls, divname)
		{
			ld = parseInt(ld);
			lh = parseInt(lh);
			lm = parseInt(lm);
			ls = parseInt(ls);
			--ls;
			if(ld <= 0 && lh <= 0 && lm <= 0 && ls <= 0){
				var txt = "<span style='margin-left:80px; font-size:14px'>已结束</span>";
				clearTimeout(t);
				$("."+divname).html(txt);
				return false;
			}else{

				if(ls < 0){ls = 59; --lm;}
				if(lm < 0){lm = 59; --lh;}
				if(lh < 0){lh = 23; --ld;}

				if(lh < 10){lh = '0'+lh;}
				if(lm < 10){lm = '0'+lm;}
				if(ls < 10){ls = '0'+ls;}

				if(ld < 10){ld = '0' + ld;}

				$("."+divname).find('.time_color').eq(0).html(ld);
				$("."+divname).find('.time_color').eq(1).html(lh);
				$("."+divname).find('.time_color').eq(2).html(lm);
				$("."+divname).find('.time_color').eq(3).html(ls);

			}
		 
			var t = setTimeout(function(){functions.ShowCountDown(ld,lh,lm,ls,divname);}, 1000);
		},

		GetSearchKeywordList : function(keyword)
		{
			if(keyword == ''){
				$("#searchKeywordList").hide();
				$("#historyKeywordList").show();
			}
			else
			{
				$.get(
					"/index.php?a=searchKeywordList", 
					{ m : keyword },
					function(data){
						$("#searchKeywordList").html(data);
						$("#hostorykeywordList").hide();
						$("#searchKeywordList").show();
					},
					'text'
				);
			}
		
		},
		SubcribeEmail : function(obj){
			var email = $(obj).parent().find('.email_dy').val();	
			if(email == ''){
				alert('邮箱不能为空！');
				return;
			}else{
				$.get(
					'/user.php?a=SubcribeEmail',
					{
						email : email
					},
					function(data){
						if(data.Code == 0){
							alert('订阅成功！');
						}else{
							alert(data.Message);
						}	
					},
					'json'
				);
			}
			return;
		}


};

//产品搜索
var productSearch = {

		Onfocus : function(obj){
			if(obj.value == '请输入您要搜索的商品' || obj.value == ''){
				$(obj).val('');
				$("#searchKeywordList").hide();
				$("#historyKeywordList").show();
			}else{
				functions.GetSearchKeywordList(obj.value);	
			}
		},
		Onblur : function(obj){
			if(obj.value == ''){
				$(obj).val('请输入您要搜索的商品');
			}
			$("#historyKeywordList").hide();
			$("#searchKeywordList").hide();
		},
		Onkeyup : function(obj){
			//下拉AJAX调用
			functions.GetSearchKeywordList(obj.value);
		},
};

//免邮政策
var float_box = {

	wine9FuWuFloat:function(o)
	{
		var H = 21; //差值
		var W = -30; //差值
		var source = '<div class="wine9FuWuFloat" style="cursor:pointer"><ul><li><a href="http://www.wine9.com/avc_2" target="_blank">升级礼</a></li><li><a href="http://www.wine9.com/avc_2_1" target="_blank">生日礼</a></li><li><a href="http://www.wine9.com/jifen" target="_blank">积分商城</a></li></ul></div>';
		floatDiv.move(o, source, H, W, 1);
   
	},
	wine9JiaMeng:function(o){
		var H = 38; //差值
		var W = -200; //差值
		var source = '<div class="wine9jiamengFloat"><table><tr height="25"><td><strong><a target="_blank" href="http://www.wine9.com/zs">区域经销商</a></strong></td></tr><tr height="25"><td><strong>加盟店类型</strong><a target="_blank" href="http://www.wine9.com/jm_hsnew">会所</a><a target="_blank" href="http://www.wine9.com/jm_jiujiao" target="_blank">酒窖</a><a target="_blank" href="http://www.wine9.com/jm_jiuba" target="_blank">主题酒吧</a><a target="_blank" href="http://www.wine9.com/jm_dianzhongdian" target="_blank">店中店</a></td></tr><tr></tr><tr height="25"><td><strong>部分优质加盟店展示</strong></td></tr><tr><td><a target="_blank" href="http://shenzhenhuisuo.wine9.com/" target="_blank">深圳品尚红酒</a><a target="_blank" href="http://nanjingjianye.wine9.com/" target="_blank">南京品尚红酒</a><a target="_blank" href="http://shenyang.wine9.com/">沈阳旗舰店</a></td></tr></table></div>'; 
		floatDiv.move(o, source, H, W, 1);
	},
	MYZC:function(o)
	{
		var H = 25; //差值
		var W = -160; //差值
		var source = '<div class=\"post_pop\">\r\n      <p><span class=\"red\">会员享包邮：</span>黄金以上级别会员(含黄金)</p>\r\n      <p><span class=\"red\">满150包邮：</span>北京/上海/广东/天津/浙江/江苏</p>\r\n      <p><span class=\"red\">满250包邮：</span>其他省、自治区和市区</p>\r\n  </div>\r\n';
		floatDiv.move(o, source, H, W, 1);
	},
	//货到付款checkout提示政策
	HDFKTS:function(o)
	{
		var H = 25; //差值
		var W = -160; //差值
		var source = '<div><ul><li>~~升级礼~~ </li><li>~~生日礼~~</li><li>~积分商城~</li><li>~红酒学院~</li><li>~会员社区~</li></ul></div>';
		floatDiv.move(o, source, H, W, 1);
	},
	Mobile:function(o)
	{
		var H = 25; //差值
		var W = 0; //差值
		var source = '<img src="http://image13.wine9.com/activity/2014/new_index_2014/down_load.jpg">';
		floatDiv.move(o, source, H, W, 1);
	},
	Weixin:function(o)
	{
		var H = 25; //差值
		var W = 0; //差值
		var source = '<img src="http://image13.wine9.com/activity/2014/new_index_2014/ceo.jpg">';
		floatDiv.move(o, source, H, W, 1);
	},
};


jQuery.fn.extend({
	Tabs:function(options){
		options = $.extend({
			event : 'mouseover',
			timeout : 0,
			auto : 0,
			callback : null
		}, options);
		
		var self = $(this),
			tabBox = self.children( 'div.tab_box' ).children( 'div' ),
			menu = self.children( 'ul.tab_menu' ),
			items = menu.find( 'li' ),
			timer;
			
		var tabHandle = function( elem ){
				elem.siblings( 'li' )
					.removeClass( 'current' )
					.end()
					.addClass( 'current' );
					
				tabBox.siblings( 'div' )
					.addClass( 'hide' )
					.end()
					.eq( elem.index() )
					.removeClass( 'hide' );
			},
				
			delay = function( elem, time ){
				time ? setTimeout(function(){ tabHandle( elem ); }, time) : tabHandle( elem );
			},
			
			start = function(){
				if( !options.auto ) return;
				timer = setInterval( autoRun, options.auto );
			},
			
			autoRun = function(){
				var current = menu.find( 'li.current' ),
					firstItem = items.eq(0),
					len = items.length,
					index = current.index() + 1,
					item = index === len ? firstItem : current.next( 'li' ),
					i = index === len ? 0 : index;
				
				current.removeClass( 'current' );
				item.addClass( 'current' );
				
				tabBox.siblings( 'div' )
					.addClass( 'hide' )
					.end()
					.eq(i)
					.removeClass( 'hide' );
			};
						
		items.bind( options.event, function(){
			delay( $(this), options.timeout );
			if( options.callback ){
				options.callback( self );
			}
		});
		
		if( options.auto ){
			start();
			self.hover(function(){
				clearInterval( timer );
				timer = undefined;
			},function(){
				start();
			});
		}
		
		return this;
	}
});

